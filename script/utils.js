let i18nList=["en","zh","fr","de","jp","it"],myInfo={},ActionCenter={},EventHandler={},CallbackHandlers={};var currentMode="";let getConfig=async()=>{var[e,a]=await Promise.all([chrome.storage.local.get(["wsHost","apiKey","AImodel","searchMode"]),chrome.storage.sync.get(["name","info","lang"])]);myInfo.name=a.name||myInfo.name,myInfo.info=a.info||myInfo.info,myInfo.lang=a.lang,myInfo.lang&&(myInfo.lang=myInfo.lang.toLowerCase(),i18nList.includes(myInfo.lang))||(myInfo.lang=DefaultLang),myInfo.apiKey=e.apiKey||{},myInfo.useLocalKV=!ForceBackend&&!e.wsHost,myInfo.model=e.AImodel||myInfo.model||ModelList[0],myInfo.searchMode=e.searchMode||"fullAnswer"},getDataGroup=e=>{var t={};return[...document.body.querySelectorAll('[dataGroup="'+e+'"]')].forEach(e=>{var a=e.getAttribute("dataItem");"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName?writeData(t,a,parseValue(e.value)):"true"===e.contentEditable||!0===e.contentEditable?writeData(t,a,parseValue(e.innerText)):console.log(e)}),t},setDataGroup=(e,t)=>{[...document.body.querySelectorAll('[dataGroup="'+e+'"]')].forEach(e=>{var a=e.getAttribute("dataItem"),a=readData(t,a);null!=a&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName?e.value=a:"true"===e.contentEditable||!0===e.contentEditable?e.innerText=a:console.log(e))})},setGroupSwitcher=()=>{[...document.body.querySelectorAll("[showGroup]")].forEach(e=>{var a=e.getAttribute("showGroup");e.addEventListener("click",()=>changeTab(a))})},changeTab=e=>{[...document.body.querySelectorAll("[showGroup], [group]")].forEach(e=>e.classList.remove("active")),[...document.body.querySelectorAll('[showGroup*="'+e+'"], [group*="'+e+'"]')].forEach(e=>e.classList.add("active")),currentMode=e,globalThis.afterChangeTab&&globalThis.afterChangeTab()},renderI18N=()=>{var t=I18NMessages[myInfo.lang]||I18NMessages[DefaultLang];[...document.body.querySelectorAll("[titlePath]")].forEach(e=>{var a=e.getAttribute("titlePath");"IMG"===e.tagName?e.title=readData(t,a):e.innerText=readData(t,a)}),[...document.body.querySelectorAll("[htmlPath]")].forEach(e=>{var a=e.getAttribute("htmlPath");e.innerHTML=readData(t,a)}),[...document.body.querySelectorAll("[placeholderName]")].forEach(e=>{var a=e.getAttribute("placeholderName");e.placeholder=readData(t,a)||a})},registerAction=()=>{[...document.body.querySelectorAll("[action]")].forEach(r=>{var e=r.getAttribute("action"),n=ActionCenter[e];n&&r.addEventListener("click",e=>{var a,t=r.getAttribute("dataFetch");t&&(a=getDataGroup(t)),n(r,a,e)})})},selectTranslationLanguages=(e,a)=>LangName[e]||e,parseMarkdownWithOutwardHyperlinks=(e,a,t)=>{a=marked.parse(a,{breaks:!0})||t||"";return e.innerHTML=a,[...e.querySelectorAll("a")].forEach(e=>{e.target="_blank"}),a},sendMessage=(e,a,t="BackEnd",r)=>{chrome.runtime.sendMessage({event:e,data:a,target:t,tid:r,sender:PageName,sid:currentTabId})},askSWandWait=(chrome.runtime.onMessage.addListener(e=>{var a;e&&e.target===PageName&&(a=EventHandler[e.event])&&a(e.data,e.sender,e.sid)}),(r,n)=>new Promise((e,a)=>{for(var t=newID();CallbackHandlers[t];)t=newID();CallbackHandlers[t]=[e,a],sendMessage("AskSWAndWait",{id:t,action:r,data:n})})),askAIandWait=(r,n)=>new Promise((e,a)=>{for(var t=newID();CallbackHandlers[t];)t=newID();CallbackHandlers[t]=[e,a],sendMessage("AskAIAndWait",{id:t,action:r,data:n})});EventHandler.replyAskAndWait=e=>{var a=e.id,t=e.result,r=!0,n=null;if(!a&&e.data){if(a=(t=e.data).id,r=!1!==e.ok,!a)return;t=t.result,n=e.error}e=CallbackHandlers[a];e&&(delete CallbackHandlers[a],r?e[0](t):e[1](n))};