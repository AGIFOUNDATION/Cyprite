globalThis.ModelContinueRequestLoopLimit=10,globalThis.ModelList=[],globalThis.Model2AI={"gemini-1.5-flash-exp-0827":"Gemini","gemini-1.5-pro-exp-0827":"Gemini","gemini-1.5-flash-002":"Gemini","gemini-1.5-pro-002":"Gemini","claude-3-5-sonnet-20240620":"Claude","claude-3-opus-20240229":"Claude","claude-3-haiku-20240307":"Claude","chatgpt-4o-latest":"OpenAI","gpt-4o-mini":"OpenAI","o1-preview":"OpenAI","o1-mini":"OpenAI","moonshot-v1-auto":"MoonShot","deepseek-chat":"DeepSeek","deepseek-coder":"DeepSeek","abab6.5s-chat":"MiniMax","glm-4-plus":"GLM","glm-4-long":"GLM","glm-4-flash":"GLM"},globalThis.AI2Model={gemini:["gemini-1.5-flash-exp-0827","gemini-1.5-pro-exp-0827","gemini-1.5-flash-002","gemini-1.5-pro-002"],claude:["claude-3-5-sonnet-20240620","claude-3-opus-20240229","claude-3-haiku-20240307"],openai:["chatgpt-4o-latest","gpt-4o-mini","o1-preview","o1-mini"],moonshot:["moonshot-v1-auto"],deepseek:["deepseek-chat","deepseek-coder"],minimax:["abab6.5s-chat"],glm:["glm-4-plus","glm-4-long","glm-4-flash"]},globalThis.FastAI={Gemini:"gemini-1.5-flash-002",Claude:"claude-3-5-sonnet-20240620",OpenAI:"gpt-4o-mini",GLM:"glm-4-flash"},globalThis.DeepAI={Gemini:"gemini-1.5-pro-002",Claude:"claude-3-opus-20240229",Openai:"o1-preview",GLM:"glm-4-plus"},globalThis.ModelOrder=["gemini","claude","openai","moonshot","deepseek","minimax","glm"],globalThis.ModelNameList={"gemini-1.5-flash-exp-0827":"GeminiFlash","gemini-1.5-pro-exp-0827":"GeminiPro","claude-3-5-sonnet-20240620":"Sonnet3.5","claude-3-opus-20240229":"Opus3","chatgpt-4o-latest":"GPT","gpt-4o-mini":"GPTMini","o1-preview":"O1","o1-mini":"O1-Mini","moonshot-v1-auto":"KIMI","deepseek-chat":"DeepSeek","abab6.5s-chat":"MiniMax","glm-4-plus":"GLMPlus","glm-4-long":"GLMLong","glm-4-flash":"GLMFlash"},globalThis.ModelDefaultConfig={Gemini:{header:{"content-type":"application/json"},chat:{generationConfig:{temperature:1,topP:.95,topK:32,candidateCount:1,maxOutputTokens:8192,responseMimeType:"text/plain",stopSequences:[]},safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]}},Claude:{header:{Accept:"application/json","content-type":"application/json","anthropic-version":"2023-06-01","anthropic-beta":"messages-2023-12-15","anthropic-dangerous-direct-browser-access":!0},chat:{top_k:3,temperature:1,max_tokens:4096}},OpenAI:{header:{"Content-Type":"application/json"},chat:{temperature:1,max_tokens:4096}},GLM:{header:{"Content-Type":"application/json"},chat:{temperature:.95,max_tokens:4095}},MoonShot:{header:{"Content-Type":"application/json"},chat:{temperature:1,max_tokens:8192}},DeepSeek:{header:{Accept:"application/json","Content-Type":"application/json"},chat:{temperature:1,max_tokens:8192}},MiniMax:{header:{"Content-Type":"application/json"},chat:{temperature:.9,max_tokens:245760}},"claude-3-5-sonnet-20240620":{header:{"anthropic-beta":"max-tokens-3-5-sonnet-2024-07-15"},chat:{max_tokens:8192}},"chatgpt-4o-latest":{chat:{max_tokens:16384}},"gpt-4o-mini":{chat:{max_tokens:16384}},"o1-preview":{chat:{max_tokens:32768}},"o1-mini":{chat:{max_tokens:65536}}},globalThis.getFunctionalModelList=e=>{var i=[];return(FunctionalModel[e]||[]).forEach(e=>{var t=Model2AI[e];t&&(t=t.toLowerCase(),myInfo.apiKey[t])&&i.push(e)}),i.includes(myInfo.model)||i.push(myInfo.model),i},globalThis.FunctionalModel={excludeIrrelevants:["gemini-1.5-flash-exp-0827","o1-mini","deepseek-chat","moonshot-v1-auto"],identityRelevants:["chatgpt-4o-latest","deepseek-chat","glm-4-plus","claude-3-5-sonnet-20240620"]},globalThis.ModelRateLimit={OpenAI:{rpm:5e3,tpm:8e5},Claude:{rpm:2e3,tpm:16e4},Gemini:{rpm:15,tpm:32e3},GLM:{rpm:20,tpm:0},MoonShot:{rpm:3,tpm:32e3},MiniMax:{rpm:6,tpm:24e3},"chatgpt-4o-latest":{rpm:1e4,tpm:3e7},"gpt-4o-mini":{rpm:3e4,tpm:15e7},"o1-preview":{rpm:500,tpm:3e7},"o1-mini":{rpm:1e3,tpm:15e7},"claude-3-opus-20240229":{tpm:8e4},"gemini-1.5-flash-exp-0827":{rpm:15,tpm:1e6},"gemini-1.5-pro-exp-0827":{rpm:2,tpm:32e3},"gemini-1.5-flash-002":{rpm:15,tpm:1e6},"gemini-1.5-pro-002":{rpm:2,tpm:32e3},"glm-4-long":{rpm:5},"glm-4-flash":{rpm:200}};let OneMinute=6e4,ModelRequestHistory={},ModelRequestPending={},getRateLimitHistory=e=>{var t=ModelRequestHistory[e];return t||(t={start:[],finish:[]},ModelRequestHistory[e]=t),t};globalThis.requestRateLimitLock=l=>new Promise(async e=>{var t=Model2AI[l]||"",t=(ModelRateLimit[l]||{}).rpm||(ModelRateLimit[t]||{}).rpm||0;if(t<=0)return e();var i=Date.now(),a=getRateLimitHistory(l),o=0,n=0,s=(a.start=a.start.filter(e=>i-e<=OneMinute),a.start.length>=t&&(o=OneMinute-i+a.start[0]),a.finish=a.finish.filter(e=>i-e<=OneMinute),a.finish.length>=t&&(n=OneMinute-i+a.finish[0]),Math.max(o,n)),o=(logger.strong("RPM","RPM "+l+" : "+t+" ("+a.start.length+", "+a.finish.length+") "+s),ModelRequestPending[l]);if(o||(o=[],ModelRequestPending[l]=o),o.push(e),0!==s){for(logger.strong("RPM","RPM Waiting: "+l);0<s;)5e3<s?(s-=5e3,await wait(5e3)):(await wait(s),s=0);await requestRateLimitLock(l),logger.strong("RPM","RPM Continue: "+l)}e=o[0],o.shift(),e&&e()}),globalThis.updateRateLimitLock=(e,t,i,a)=>{var o=Date.now(),e=getRateLimitHistory(e);(t?e.start:e.finish).unshift(o),e.start=e.start.filter(e=>o-e<=OneMinute),e.finish=e.finish.filter(e=>o-e<=OneMinute)};