globalThis.ModelList=[],globalThis.Model2AI={"gemini-1.5-flash-exp-0827":"Gemini","gemini-1.5-pro-exp-0827":"Gemini","claude-3-5-sonnet-20240620":"Claude","claude-3-opus-20240229":"Claude","chatgpt-4o-latest":"OpenAI","gpt-4o-mini":"OpenAI","o1-preview":"OpenAI","o1-mini":"OpenAI","moonshot-v1-auto":"MoonShot","deepseek-chat":"DeepSeek","deepseek-coder":"DeepSeek","glm-4-plus":"GLM","glm-4-long":"GLM","glm-4-flash":"GLM"},globalThis.AI2Model={gemini:["gemini-1.5-flash-exp-0827","gemini-1.5-pro-exp-0827"],claude:["claude-3-5-sonnet-20240620","claude-3-opus-20240229"],openai:["chatgpt-4o-latest","gpt-4o-mini","o1-preview","o1-mini"],moonshot:["moonshot-v1-auto"],deepseek:["deepseek-chat","deepseek-coder"],glm:["glm-4-plus","glm-4-long","glm-4-flash"]},globalThis.FastAI={Gemini:"gemini-1.5-flash-exp-0827",Claude:"claude-3-5-sonnet-20240620",OpenAI:"gpt-4o-mini",GLM:"glm-4-flash"},globalThis.DeepAI={Gemini:"gemini-1.5-pro-exp-0827",Claude:"claude-3-opus-20240229",Openai:"o1-preview",GLM:"glm-4-plus"},globalThis.ModelOrder=["gemini","claude","openai","moonshot","deepseek","glm"],globalThis.ModelNameList={"gemini-1.5-flash-exp-0827":"GeminiFlash","gemini-1.5-pro-exp-0827":"GeminiPro","claude-3-5-sonnet-20240620":"Sonnet3.5","claude-3-opus-20240229":"Opus3","chatgpt-4o-latest":"GPT","gpt-4o-mini":"GPTMini","o1-preview":"O1","o1-mini":"O1-Mini","moonshot-v1-auto":"KIMI","deepseek-chat":"DeepSeek","deepseek-coder":"DeepSeekCoder","glm-4-plus":"GLMPlus","glm-4-long":"GLMLong","glm-4-flash":"GLMFlash"},globalThis.ModelDefaultConfig={Gemini:{header:{"content-type":"application/json"},chat:{generationConfig:{temperature:1,topP:.95,topK:64,candidateCount:1,maxOutputTokens:8192,responseMimeType:"text/plain",stopSequences:[]},safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]}},Claude:{header:{Accept:"application/json","content-type":"application/json","anthropic-version":"2023-06-01","anthropic-beta":"messages-2023-12-15","anthropic-dangerous-direct-browser-access":!0},chat:{top_k:3,temperature:1,max_tokens:4096}},OpenAI:{header:{"Content-Type":"application/json"},chat:{temperature:1,max_tokens:4096}},GLM:{header:{"Content-Type":"application/json"},chat:{temperature:.95,max_tokens:4095}},MoonShot:{header:{"Content-Type":"application/json"},chat:{temperature:1,max_tokens:8192}},DeepSeek:{header:{Accept:"application/json","Content-Type":"application/json"},chat:{temperature:1,max_tokens:8192}},"claude-3-5-sonnet-20240620":{header:{"anthropic-beta":"max-tokens-3-5-sonnet-2024-07-15"},chat:{max_tokens:8192}},"chatgpt-4o-latest":{chat:{max_tokens:16384}},"gpt-4o-mini":{chat:{max_tokens:16384}},"o1-preview":{chat:{max_tokens:32768}},"o1-mini":{chat:{max_tokens:65536}}},globalThis.ModelRateLimit={OpenAI:{rpm:5e3,tpm:8e5},Claude:{rpm:2e3,tpm:16e4},Gemini:{rpm:15,tpm:32e3},GLM:{rpm:20,tpm:0},MoonShot:{rpm:3,tpm:32e3},"chatgpt-4o-latest":{rpm:1e4,tpm:3e7},"gpt-4o-mini":{rpm:3e4,tpm:15e7},"o1-preview":{rpm:500,tpm:3e7},"o1-mini":{rpm:1e3,tpm:15e7},"claude-3-opus-20240229":{tpm:8e4},"gemini-1.5-flash-exp-0827":{rpm:15,tpm:1e6},"gemini-1.5-pro-exp-0827":{rpm:2,tpm:32e3},"glm-4-long":{rpm:5},"glm-4-flash":{rpm:200}};let OneMinute=6e4,ModelRequestHistory={},ModelRequestPending={},getRateLimitHistory=e=>{var t=ModelRequestHistory[e];return t||(t={start:[],finish:[]},ModelRequestHistory[e]=t),t};globalThis.requestRateLimitLock=p=>new Promise(async e=>{var t=Model2AI[p]||"",t=(ModelRateLimit[p]||{}).rpm||(ModelRateLimit[t]||{}).rpm||0;if(t<=0)return e();var i=Date.now(),o=getRateLimitHistory(p),n=0,a=0,s=(o.start=o.start.filter(e=>i-e<=OneMinute),o.start.length>=t&&(n=OneMinute-i+o.start[0]),o.finish=o.finish.filter(e=>i-e<=OneMinute),o.finish.length>=t&&(a=OneMinute-i+o.finish[0]),Math.max(n,a)),n=(logger.strong("RPM","RPM "+p+" : "+t+" ("+o.start.length+", "+o.finish.length+") "+s),ModelRequestPending[p]);if(n||(n=[],ModelRequestPending[p]=n),n.push(e),0!==s){for(logger.strong("RPM","RPM Waiting: "+p);0<s;)5e3<s?(s-=5e3,await wait(5e3)):(await wait(s),s=0);await requestRateLimitLock(p),logger.strong("RPM","RPM Continue: "+p)}e=n[0],n.shift(),e&&e()}),globalThis.updateRateLimitLock=(e,t,i,o)=>{var n=Date.now(),e=getRateLimitHistory(e);(t?e.start:e.finish).unshift(n),e.start=e.start.filter(e=>n-e<=OneMinute),e.finish=e.finish.filter(e=>n-e<=OneMinute)};